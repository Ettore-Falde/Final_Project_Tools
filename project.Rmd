---
title: "Final Project"
author: "Ettore Falde, Samoussa Fofana, Federico Basaglia"
date: "11/29/2021"
output: pdf_document
---


# Introduction
Let's consider that the new CEO of a specific IT company has contacted us because she wants us to analyze the current Human Resources status of the company. She has just sent a data set with all available employee information. This information is in the attached data set. As we can see, the company has two locations: the first one in London, and the second one in Barcelona.

The new CEO is concerned about several issues. She truly believes in gender equality in organizations as it implies a signal to society. On the other hand, she is concerned that the offices in Barcelona do not follow a similar structure to the one in London. In her opinion, the structure of the Barcelona offices should tend towards the London structure. In her meeting with us, she also told us that she would like to know the attitudes (e.g., satisfaction) of the employees across the different departments and if anything could be done to improve them. Finally, she commented that she is very concerned about the company's succession strategy and in particular some positions in certain departments.

Based on this information, we need to carry out an exploratory data analysis and prepare a technical report (with Rmarkdown) and a technical presentation (5-10 minutes).

Note: It is highly recommended to seek external sources of information (either in dataset or report formats) for the analysis and the reporting.  


# Setup the software

The software used for the development of the study and the writing of the report is R[1]. The first step is to define the work directory and to load the libraries needed:  

```{r, echo = FALSE, message=FALSE, warning=FALSE}
# Directory
setwd("/Users/ettorefalde/Documents/Ettore\ Falde/UNI/UPC/Tools\ for\ Decision\ Making\ /Final_Project_Tools")
```

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(broom)
library(caTools)
library(ROCR)
library(corrplot)
library(dplyr)
library(janitor)
```

## Importing Data

The first step is to load the dataset in the system, and check the names of the variables. 

```{r}
mydb <- read.csv2("dataset.csv")
names(mydb)
# web_db <- read.csv("WA_Fn-UseC_-HR-Employee-Attrition.csv")
# names(web_db)
```

We got the dataset from the website of Atenea.
The variables selected for this dataset  are:

1. **Age**:  boolean variable, male = 1, female = 0
2. **Attrition**: age of the person
3. **BusinessTravel**: level of education 
4. **DailyRate**: boolean variable, smoker = 1, non-smoker = 0
5. **Department**: number of sigarettes smoked in one day
6. **DistanceFromHome**: medical history risk factors
7. **Education**: boolean var, predisposition to get stroke
8. **EducationField**: boolean var, predisposition to get hyp
9. **EmployeeCount**: boolean var, predisposition to get diabetes
10. **EmployeeNumber**:  total cholesterol level
11. **EnvironmentSatisfaction**: systolic blood pressure
12. **Gender**: diastolic blood pressure 
13. **HourlyRate**: Body Mass Index
14. **JobInvolvement**:  heartRate
15. **JobLevel**: glucose level
16. **JobRole**: whether or not the patient developed coronary heart disease in the next 10 years
17. **JobSatisfaction**: whether or not the patient developed coronary heart disease in the next 10 years
18. **MaritalStatus**: whether or not the patient developed coronary heart disease in the next 10 years
19. **MonthlyIncome**: whether or not the patient developed coronary heart disease in the next 10 years
20. **MonthlyRate**: whether or not the patient developed coronary heart disease in the next 10 years
21. **NumCompaniesWorked**: whether or not the patient developed coronary heart disease in the next 10 years
22. **Over18**: whether or not the patient developed coronary heart disease in the next 10 years
23. **OverTime**: whether or not the patient developed coronary heart disease in the next 10 years
24. **PercentSalaryHike**: whether or not the patient developed coronary heart disease in the next 10 years
25. **PerformanceRating**: whether or not the patient developed coronary heart disease in the next 10 years
26. **RelationshipSatisfaction**: whether or not the patient developed coronary heart disease in the next 10 years
27. **StandardHours**: whether or not the patient developed coronary heart disease in the next 10 years
28. **StockOptionLevel**: whether or not the patient developed coronary heart disease in the next 10 years
29. **TotalWorkingYears**: whether or not the patient developed coronary heart disease in the next 10 years
30. **TrainingTimesLastYear**: whether or not the patient developed coronary heart disease in the next 10 years
31. **WorkLifeBalance**: whether or not the patient developed coronary heart disease in the next 10 years
32. **YearsAtCompany**: whether or not the patient developed coronary heart disease in the next 10 years
33. **YearsInCurrentRole**: whether or not the patient developed coronary heart disease in the next 10 years
34. **YearsSinceLastPromotion**: whether or not the patient developed coronary heart disease in the next 10 years
35. **YearsWithCurrManager**: whether or not the patient developed coronary heart disease in the next 10 years
36. **City**: whether or not the patient developed coronary heart disease in the next 10 years


# Cleaning Data

#### Names
In this sub-point we are going to change the names of the variables in order to have all he names of the variables with the same layout. 
```{r}
mydb <- mydb %>% clean_names(., "snake")
```

#### Dimensions
First of all, we are going to check the actual dimension of our dataset. 
Hence, from the following code we can  understand that there are 36 variables in total and 
```{r}
mydb %>% dim()
mydb %>% nrow()
mydb %>% ncol()
```

#### Head and Tail
Here, we are going to check the first 10 elements at the beginning and at the end of the dataset. Consecutively, we are going to check the top and the bottom values of the main relevant variables to catch some errors. 
```{r}
mydb %>% head(10)
mydb %>% tail(10)

mydb %>% arrange(desc(age)) %>% top_n(10, age) 
mydb %>% arrange(age) %>% top_n(-10, age) 
```

#### Removing
In this part of the data cleaning we are going to remove all the blank rows, the duplicates and strange values that may affect our analysis.
```{r}
# Remove blank rows and columsn 
mydb <- mydb %>% remove_empty(c("rows", "cols"))

# Removing entries with too high and too low age
mydb <- mydb %>% filter(age <= 80 & age >= 16)
mydb <- mydb %>% filter(job_involvement <= 4)
mydb <- mydb %>% filter(num_companies_worked >= 0)
```
Therefore, as we can see, this line of code did not affected our dataset. So, this mean that there are no rows or columns that are empty.

Now, we are going to pass to the study of duplicates, by the _employee_number_ variable that we suggest it is the key.
```{r}
# Duplicates removal
mydb %>% get_dupes(employee_number)
mydb <- mydb %>% distinct(employee_number, .keep_all= TRUE)
```


Hence, now it is time to check the n's.
```{r}
mydb %>% tabyl(attrition)

mydb %>% tabyl(business_travel)
mydb <- mydb %>% filter(business_travel != "")

mydb %>% tabyl(department)
mydb <- mydb %>% filter(department != "")
mydb$department <- ifelse(mydb$department == 
                            "Research and Development", 
                          "Research & Development", mydb$department)

mydb %>% tabyl(education_field)
mydb <- mydb %>% filter(department != "") # this doesn't work cause it is empthy

mydb %>% tabyl(gender)
mydb <- mydb %>% filter(gender != "")
mydb$gender <- ifelse(mydb$gender == 
                            "female", 
                          "Female", mydb$gender)
mydb$gender <- ifelse(mydb$gender == 
                            "female ", 
                          "Female", mydb$gender)
mydb$gender <- ifelse(mydb$gender == 
                            "male", 
                          "Male", mydb$gender)


mydb %>% tabyl(job_role)
mydb <- mydb %>% filter(job_role != "")


mydb %>% tabyl(marital_status)
mydb <- mydb %>% filter(marital_status != "")
mydb$marital_status <- ifelse(mydb$marital_status == 
                            "Marrie", 
                          "Married", mydb$marital_status)
mydb$marital_status <- ifelse(mydb$marital_status == 
                            "Soltero", 
                          "Single", mydb$marital_status)


mydb %>% tabyl(over18)
mydb <- mydb %>% filter(marital_status != "") # this doesn't work cause it is empthy

mydb %>% tabyl(city)
mydb$city <- ifelse(mydb$city == 
                            "Barcelone", 
                          "Barcelona", mydb$city)
```

To conclude, the cleaning of the dataset, we are going to remove every line with at least one empy gap. 
```{r}
mydb <- mydb %>% drop_na()
```




# Analysis
...

# Conclusions
...

# Referemces
1. _M., L. (2004). Moneyball: The art of winning an unfair game. New york: John Wiley and sons._
2. Wickham et al., (2019). Welcome to the tidyverse. Journal of Open Source Software, 4(43), 1686, https://doi.org/10.21105/joss.01686
3. H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York, 2016.
4. David Robinson, Alex Hayes and Simon Couch (2021). broom: Convert Statistical Objects into Tidy Tibbles. R package version 0.7.9. https://CRAN.R-project.org/package=broom



